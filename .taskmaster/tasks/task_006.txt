# Task ID: 6
# Title: 동적 라우팅 시스템 구현
# Status: pending
# Dependencies: 1, 2, 3, 4
# Priority: medium
# Description: 작업 타입에 따라 적절한 노드를 선택하는 동적 라우팅 시스템을 구현합니다.
# Details:
1. 작업 타입 분류기 구현 (coding, testing, debugging, documentation)
2. 노드 선택 로직 구현
3. 컨텍스트 기반 라우팅 메커니즘 설계
4. 실패 시 대체 경로 선택 로직 구현

```python
from typing import Literal

# 작업 타입 정의
TaskType = Literal['coding', 'testing', 'debugging', 'documentation']

class DynamicRouter:
    def __init__(self, llm):
        self.llm = llm
        self.routes = {
            'coding': ['reasoning', 'coding_action', 'reflection'],
            'testing': ['reasoning', 'testing_action', 'reflection'],
            'debugging': ['reasoning', 'debugging_action', 'reflection'],
            'documentation': ['reasoning', 'documentation_action', 'reflection']
        }
        self.fallback_routes = {
            'coding': 'debugging',
            'testing': 'coding',
            'debugging': 'coding',
            'documentation': 'coding'
        }
    
    def classify_task(self, input_text: str) -> TaskType:
        """입력 텍스트를 기반으로 작업 타입 분류"""
        prompt = f"""
        다음 입력을 분석하고 작업 타입을 분류하세요:
        
        {input_text}
        
        가능한 작업 타입: coding, testing, debugging, documentation
        작업 타입만 응답하세요.
        """
        
        response = self.llm.invoke(prompt).strip().lower()
        if response in self.routes:
            return response
        return 'coding'  # 기본값
    
    def get_route(self, task_type: TaskType, context: dict = None):
        """작업 타입에 따른 라우트 반환"""
        return self.routes[task_type]
    
    def get_fallback_route(self, task_type: TaskType):
        """실패 시 대체 경로 반환"""
        return self.routes[self.fallback_routes[task_type]]

# LangGraph에 통합
def route_selector(state: AgentState) -> dict:
    """다음 노드를 동적으로 선택"""
    router = DynamicRouter(llm)
    task_type = router.classify_task(state['input'])
    
    # 실패 여부 확인
    if 'failure' in state and state['failure']:
        route = router.get_fallback_route(task_type)
    else:
        route = router.get_route(task_type, state)
    
    return {"next": route[0]}
```

# Test Strategy:
1. 작업 타입 분류 정확도 테스트
2. 다양한 입력에 대한 라우팅 정확성 검증
3. 컨텍스트 기반 라우팅 적절성 평가
4. 실패 시 대체 경로 선택 로직 테스트
5. 전체 라우팅 시스템 통합 테스트

# Subtasks:
## 1. 작업 타입 분류기 설계 및 구현 [pending]
### Dependencies: None
### Description: 입력 텍스트를 분석하여 작업 타입(coding, testing, debugging, documentation)을 정확히 분류하는 시스템 구현
### Details:
1. LLM 기반 작업 타입 분류 프롬프트 최적화
2. 분류 정확도 향상을 위한 예시 데이터셋 구축
3. 분류 결과의 신뢰도 점수 계산 메커니즘 추가
4. 모호한 입력에 대한 처리 로직 구현
5. 분류기 성능 평가 및 튜닝

## 2. 노드 선택 및 라우팅 로직 구현 [pending]
### Dependencies: 6.1
### Description: 작업 타입에 따라 적절한 노드 시퀀스를 선택하고 라우팅하는 핵심 로직 개발
### Details:
1. 작업 타입별 최적 노드 시퀀스 정의 및 구현
2. 라우팅 테이블 구조 최적화
3. 노드 간 데이터 전달 메커니즘 구현
4. LangGraph와의 통합을 위한 route_selector 함수 완성
5. 라우팅 결정 과정 로깅 기능 추가

## 3. 컨텍스트 기반 라우팅 메커니즘 개발 [pending]
### Dependencies: 6.2
### Description: 현재 상태와 이전 실행 이력을 고려한 컨텍스트 기반 라우팅 메커니즘 구현
### Details:
1. 상태 컨텍스트 구조 설계 및 구현
2. 이전 실행 이력 분석 로직 개발
3. 컨텍스트 기반 라우팅 결정 알고리즘 구현
4. 컨텍스트 가중치 조정 메커니즘 추가
5. 상태 변화에 따른 동적 라우팅 최적화

## 4. 실패 시 대체 경로 선택 및 복구 로직 구현 [pending]
### Dependencies: 6.2, 6.3
### Description: 노드 실행 실패 시 대체 경로를 선택하고 복구하는 견고한 메커니즘 개발
### Details:
1. 실패 감지 및 분류 시스템 구현
2. 작업 타입별 최적 대체 경로 정의
3. 실패 상황에서의 상태 복구 메커니즘 개발
4. 반복적 실패 처리를 위한 에스컬레이션 로직 구현
5. 실패 이력 관리 및 학습 메커니즘 추가

